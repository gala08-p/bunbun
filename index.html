<!DOCTYPE html><html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <title>文化祭</title>
    <meta name="description" content="文化祭" />
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=Kaisei+Decol&display=swap"
      rel="stylesheet"
    />
</head>
<body>
    <p class="midasi">商品一覧</p>
<div class="pop">
  <h2>ポップコーン</h2>
</div>

<div class="menu">
  <div class="pops">
    <p>キャラメル</p>
    <img src="キャラメル.jpg" class="pic_pop" />
    <p>400円</p>
    <div class="quantity-container">
      <button type="button" class="quantity-btn minus-btn">−</button>
      <input
        type="number"
        min="0"
        value="0"
        max="10"
        data-name="キャラメルポップコーン"
        data-price="400"
      />
      <button type="button" class="quantity-btn plus-btn">＋</button>
    </div>
    <button type="button" class="reset-btn">リセット</button>
  </div>
</div>

<div class="menu">
  <div class="pops">
    <p>塩</p>
    <img src="ソルト.jpg" class="pic_pop" />
    <p>400円</p>
    <div class="quantity-container">
      <button type="button" class="quantity-btn minus-btn">−</button>
      <input
        type="number"
        min="0"
        value="0"
        max="10"
        data-name="塩ポップコーン"
        data-price="400"
      />
      <button type="button" class="quantity-btn plus-btn">＋</button>
    </div>
    <button type="button" class="reset-btn">リセット</button>
  </div>
</div>
<div class="pop">
  <h2>かき氷</h2>
</div>

<div class="menu">
  <div class="kakis">
    <p>ブルーハワイ</p>
    <img src="ブルーハワイ.jpg" class="pic_pan" />
    <p>400円</p>
    <div class="quantity-container">
      <button type="button" class="quantity-btn minus-btn">−</button>
      <input
        type="number"
        min="0"
        value="0"
        max="10"
        data-name="ブルーハワイかき氷"
        data-price="400"
      />
      <button type="button" class="quantity-btn plus-btn">＋</button>
    </div>
    <button type="button" class="reset-btn">リセット</button>
  </div>

  <div class="pans">
    <p>いちご</p>
    <img src="イチゴ.jpg" class="pic_pop" />
    <p>400円</p>
    <div class="quantity-container">
      <button type="button" class="quantity-btn minus-btn">−</button>
      <input
        type="number"
        min="0"
        value="0"
        max="10"
        data-name="いちごかき氷"
        data-price="400"
      />
      <button type="button" class="quantity-btn plus-btn">＋</button>
    </div>
    <button type="button" class="reset-btn">リセット</button>
  </div>

  <div class="pans">
    <p>コーラ</p>
    <img src="コーラ.jpg" class="pic_pop" />
    <p>400円</p>
    <div class="quantity-container">
      <button type="button" class="quantity-btn minus-btn">−</button>
      <input
        type="number"
        min="0"
        value="0"
        max="10"
        data-name="コーラかき氷"
        data-price="400"
      />
      <button type="button" class="quantity-btn plus-btn">＋</button>
    </div>
    <button type="button" class="reset-btn">リセット</button>
  </div>
</div>

<div class="menu">
  <div class="kakis">
    <p>グレープ</p>
    <img src="グレープ.jpg" class="pic_pan" />
    <p>400円</p>
    <div class="quantity-container">
      <button type="button" class="quantity-btn minus-btn">−</button>
      <input
        type="number"
        min="0"
        value="0"
        max="10"
        data-name="グレープかき氷"
        data-price="400"
      />
      <button type="button" class="quantity-btn plus-btn">＋</button>
    </div>
    <button type="button" class="reset-btn">リセット</button>
  </div>

  <div class="pans">
    <p>マンゴー</p>
    <img src="マンゴー.jpg" class="pic_pop" />
    <p>400円</p>
    <div class="quantity-container">
      <button type="button" class="quantity-btn minus-btn">−</button>
      <input
        type="number"
        min="0"
        value="0"
        max="10"
        data-name="マンゴーかき氷"
        data-price="400"
      />
      <button type="button" class="quantity-btn plus-btn">＋</button>
    </div>
    <button type="button" class="reset-btn">リセット</button>
  </div>

  <div class="pans">
    <p>メロン</p>
    <img src="メロン.jpg" class="pic_pop" />
    <p>400円</p>
    <div class="quantity-container">
      <button type="button" class="quantity-btn minus-btn">−</button>
      <input
        type="number"
        min="0"
        value="0"
        max="10"
        data-name="メロンかき氷"
        data-price="400"
      />
      <button type="button" class="quantity-btn plus-btn">＋</button>
    </div>
    <button type="button" class="reset-btn">リセット</button>
  </div>
</div>

<!-- ... 中略（あなたのコードの <head> 部分は変更なし） ... -->
  <!-- ここはそのままでOK（商品リストなど） -->

  <button class="order-btn" onclick="confirmOrder()">注文を確認</button>  <!-- ポップアップウィンドウ -->
  <div class="overlay" id="overlay">
    <div class="popup" id="popup">
      <div id="popupContent"></div>
      <button class="confirm-btn" onclick="submitOrder()">確定</button>
      <button class="close-btn" onclick="closePopup()">閉じる</button>
    </div>
  </div>


 <script>
  const STORAGE_KEY = "orderQuantities";

  // 初期化（保存データ復元）
  window.addEventListener("DOMContentLoaded", () => {
    const savedData = localStorage.getItem(STORAGE_KEY);
    if (savedData) {
      const quantities = JSON.parse(savedData);
      document.querySelectorAll('input[type="number"]').forEach((input) => {
        const name = input.dataset.name;
        if (quantities[name] !== undefined) {
          input.value = quantities[name];
        }
      });
    }
  });

  // 保存関数
  function saveToStorage() {
    const data = {};
    document.querySelectorAll('input[type="number"]').forEach((input) => {
      data[input.dataset.name] = Number(input.value);
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  // +, -, リセットボタン
  document.querySelectorAll(".plus-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const input = btn.parentElement.querySelector("input");
      input.value = Math.min(10, Number(input.value) + 1);
      saveToStorage();
    });
  });

  document.querySelectorAll(".minus-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const input = btn.parentElement.querySelector("input");
      input.value = Math.max(0, Number(input.value) - 1);
      saveToStorage();
    });
  });

  document.querySelectorAll(".reset-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const input = btn.previousElementSibling.querySelector("input");
      input.value = 0;
      saveToStorage();
    });
  });

  document.querySelectorAll('input[type="number"]').forEach((input) => {
    input.addEventListener("input", () => {
      if (input.value < 0) input.value = 0;
      if (input.value > 10) input.value = 10;
      saveToStorage();
    });
  });

  // 注文確認ポップアップ
  function confirmOrder() {
    const items = [];
    let total = 0;

    document.querySelectorAll('input[type="number"]').forEach((input) => {
      const qty = Number(input.value);
      if (qty > 0) {
        const name = input.dataset.name;
        const price = Number(input.dataset.price);
        total += qty * price;
        items.push(`<li>${name}：${qty}個（${qty * price}円）</li>`);
      }
    });

    const popupContent = document.getElementById("popupContent");
    if (items.length > 0) {
      popupContent.innerHTML = `
        <h3>注文内容の確認</h3>
        <ul>${items.join("")}</ul>
        <p>合計金額：<strong>${total}円</strong></p>
        <p style="color:red;">※この画面で「確定」は押さないでください</p>
      `;
    } else {
      popupContent.innerHTML = "<p>注文が選択されていません。</p>";
    }

    document.getElementById("overlay").style.display = "flex";
  }

  function closePopup() {
    document.getElementById("overlay").style.display = "none";
  }

  const BASEROW_API = "https://api.baserow.io/api/database/rows/table/573706/";
  const BASEROW_TOKEN = "lMENlhh1Gljldo3b9iIqeV1TEz4OaDM0";

  function submitOrder() {
    const now = new Date();
    const nitji = now.toLocaleString("ja-JP", { timeZone: "Asia/Tokyo" });
    const items = {};
    let total = 0;

    document.querySelectorAll('input[type="number"]').forEach((input) => {
      const key = input.dataset.name;
      const qty = Number(input.value);
      if (qty > 0) {
        const col = mapNameToColumn(key);
        if (col) {
          items[col] = qty;
          total += qty * Number(input.dataset.price);
        }
      }
    });

    if (Object.keys(items).length === 0) {
      alert("注文がありません。");
      return;
    }

    items["Goukei"] = total;
    items["Nitji"] = nitji;

    fetch(BASEROW_API, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Token ${BASEROW_TOKEN}`,
      },
      body: JSON.stringify(items),
    })
      .then((res) => {
        if (!res.ok) throw new Error(`Error: ${res.status}`);
        closePopup();
        alert("注文が確定し、Baserow に送信されました！");
      })
      .catch((err) => {
        console.error(err);
        alert("送信中にエラーが発生しました。");
      });
  }

  function mapNameToColumn(name) {
    const mapping = {
      "キャラメルポップコーン": "Kyarameru",
      "塩ポップコーン": "Sio",
      "ブルーハワイかき氷": "Bru_hawai",
      "いちごかき氷": "Itigo",
      "コーラかき氷": "Ko_ra",
      "グレープかき氷": "Gure_pu",
      "マンゴーかき氷": "Mango",
      "メロンかき氷": "Meron"
    };
    return mapping[name] || "";
  }
</script>


 
</body>
