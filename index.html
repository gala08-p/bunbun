<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>注文ページ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>注文フォーム</h2>

<table>
  <thead>
    <tr>
      <th>商品</th>
      <th>価格</th>
      <th>数量</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>キャラメルポップコーン</td><td>300</td>
      <td><input type="number" data-name="キャラメルポップコーン" data-price="300" value="0" min="0" max="10"></td></tr>
    <tr><td>塩ポップコーン</td><td>300</td>
      <td><input type="number" data-name="塩ポップコーン" data-price="300" value="0" min="0" max="10"></td></tr>
    <tr><td>ブルーハワイかき氷</td><td>200</td>
      <td><input type="number" data-name="ブルーハワイかき氷" data-price="200" value="0" min="0" max="10"></td></tr>
    <tr><td>いちごかき氷</td><td>200</td>
      <td><input type="number" data-name="いちごかき氷" data-price="200" value="0" min="0" max="10"></td></tr>
    <tr><td>コーラかき氷</td><td>200</td>
      <td><input type="number" data-name="コーラかき氷" data-price="200" value="0" min="0" max="10"></td></tr>
    <tr><td>グレープかき氷</td><td>200</td>
      <td><input type="number" data-name="グレープかき氷" data-price="200" value="0" min="0" max="10"></td></tr>
    <tr><td>マンゴーかき氷</td><td>200</td>
      <td><input type="number" data-name="マンゴーかき氷" data-price="200" value="0" min="0" max="10"></td></tr>
    <tr><td>メロンかき氷</td><td>200</td>
      <td><input type="number" data-name="メロンかき氷" data-price="200" value="0" min="0" max="10"></td></tr>
  </tbody>
</table>

<div style="text-align:center;">
  <button onclick="showPopup()">注文を確認</button>
</div>

<!-- 備考欄 -->
<div style="margin-top: 20px; text-align: center;">
  <label for="note">備考：</label><br />
  <textarea id="note" rows="3" style="width: 90%; max-width: 500px;"></textarea>
</div>

<!-- ポップアップ -->
<div class="popup" id="popup">
  <div class="popup-content">
    <h3>注文内容を確認</h3>
    <div id="order-summary"></div>
    <p id="total-price"></p>
    <button onclick="submitOrder()">確定</button>
    <button onclick="closePopup()">キャンセル</button>
  </div>
</div>

<script>
  function showPopup() {
    const inputs = document.querySelectorAll('input[type="number"]');
    let summary = "";
    let total = 0;

    inputs.forEach(input => {
      const name = input.dataset.name;
      const qty = Number(input.value);
      const price = Number(input.dataset.price);
      if (qty > 0) {
        summary += `${name}：${qty}個（${qty * price}円）<br>`;
        total += qty * price;
      }
    });

    document.getElementById("order-summary").innerHTML = summary || "なし";
    document.getElementById("total-price").innerText = `合計：${total}円`;
    document.getElementById("popup").style.display = "flex";
  }

  function closePopup() {
    document.getElementById("popup").style.display = "none";
  }

  async function submitOrder() {
    const inputs = document.querySelectorAll('input[type="number"]');
    const orderData = {};
    let total = 0;

    inputs.forEach(input => {
      const name = input.dataset.name;
      const qty = Number(input.value);
      const price = Number(input.dataset.price);
      orderData[name] = qty;
      total += qty * price;
    });

    orderData["合計金額"] = total;
    orderData["備考"] = document.getElementById("note").value;

    // Baserow API設定
    const BASEROW_API_URL = 'https://api.baserow.io/api/database/rows/table/573587/?user_field_names=true';
    const BASEROW_API_TOKEN = 'IV3Llfh0X29k8dLyieIDVRHD8XWsdgQe';

    try {
      const res = await fetch(BASEROW_API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Token ${BASEROW_API_TOKEN}`
        },
        body: JSON.stringify(orderData)
      });

      if (!res.ok) {
        alert("送信に失敗しました。");
      } else {
        alert("注文を送信しました！");
        closePopup();
      }
    } catch (err) {
      console.error(err);
      alert("ネットワークエラーです。");
    }
  }
</script>

</body>
</html>

